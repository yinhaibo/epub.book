<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="format-detection"content="telephone=no"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VBook</title>
	<link rel="shortcut icon" href="../favicon.ico">
	<link rel="stylesheet" href="libs/jquerymobile/jquery.mobile-1.4.5.css">
	<link rel="stylesheet" href="css/mainview.css">
	<link rel="stylesheet" href="css/childpage.css">
	<link rel="stylesheet" href="css/personal.css">
	<link rel="stylesheet" href="css/userprofile.css">
	<link rel="stylesheet" href="css/reader.css">
	<link rel="stylesheet" href="css/readertoc.css" />
	
	<script type="text/javascript" src="cordova.js"></script>
	
	<script src="libs/jquery/jquery-2.1.4.js"></script>
	<script src="libs/jquerymobile/jquery.mobile-1.4.5.js"></script>
	<script src="js/index.js"></script>
	
	<script src="libs/epub/libs/underscore/underscore.js"></script>
    <script src="libs/epub/libs/rsvp/rsvp.js"></script>
    <script src="libs/epub/libs/fileStorage/fileStorage.min.js"></script>
	
	<script src="libs/epub/src/base.js"></script>
	<script src="libs/epub/src/core.js"></script>
	<script src="libs/epub/src/unarchiver.js"></script>
	<script src="libs/epub/src/parser.js"></script>
	<script src="libs/epub/src/hooks.js"></script>
	<script src="libs/epub/src/locations.js"></script>
	<script src="libs/epub/src/book.js"></script>
	<script src="libs/epub/src/chapter.js"></script>
	<script src="libs/epub/src/renderer.js"></script>
	<script src="libs/epub/src/replace.js"></script>
	<script src="libs/epub/src/epubcfi.js"></script>
	<script src="libs/epub/src/render_iframe.js"></script>
	<script src="libs/epub/src/layout.js"></script>
	<script src="libs/epub/src/pagination.js"></script>
     
    <!-- jszip -->
	<script src="libs/jszip/jszip.js"></script>
	<script src="libs/jszip/mime-types.js"></script>
	<!-- EPUB.js Hook -->
       <script src="libs/epub/hooks/default/smartimages.js"></script>
	<script src="libs/epub/hooks/default/smartmedia.js"></script>
	<script src="libs/epub/hooks/extensions/swipeDetection.js"></script>

	<!-- PhotoSwipe Core CSS file -->
	<link rel="stylesheet" href="libs/photoswipe/photoswipe.css"> 

	<!-- PhotoSwipe Skin CSS file (styling of UI - buttons, caption, etc.)
		 In the folder of skin CSS file there are also:
		 - .png and .svg icons sprite, 
		 - preloader.gif (for browsers that do not support CSS animations) -->
	<link rel="stylesheet" href="libs/photoswipe/default-skin/default-skin.css"> 

	<!-- PhotoSwipe Core JS file -->
	<script src="libs/photoswipe/photoswipe.js"></script> 

	<!-- PhotoSwipe UI JS file -->
	<script src="libs/photoswipe/photoswipe-ui-default.js"></script> 
	<!-- 模版引擎 -->
	<script src="libs/template.js"></script>
	<!-- VBOOK reader-->
	<script src="js/utils.js"></script> 
	<script src="js/reader.js"></script> 
	<script src="js/readhelp.js"></script> 
	<script>
		var bookReload = true;
		var documentLoad = false;
		var isApp = true;
		$(document).on('mobileinit', function () {
			$.mobile.ignoreContentEnabled = true;
		});	
		$(function(){
			$( "[data-role='navbar']" ).navbar();
			$( "[data-role='header'], [data-role='footer']" ).toolbar();
			
			documentLoad = true;
			var _os = detectOS();
			
			if (_os == "Windows" || _os == "Mac"){
				isApp = false;
			}
		});
		// Update the contents of the toolbars
		$(document).on("pageshow", "[data-role='page']", function () {
		    // Each of the four pages in this demo has a data-title attribute
		    // which value is equal to the text of the nav button
		    // For example, on first page: <div data-role="page" data-title="Info">
		    var current = $(this).jqmData("title");
		    // Change the heading
		    //$("[data-role='header'] h1").text(current);
		    // Remove active class from nav buttons
		    $("#main-footer [data-role='navbar'] a.my-btn-active").removeClass("my-btn-active");
		    // Add active class to current nav button
		    $("#main-footer [data-role='navbar'] a").each(function () {
		        if ($(this).text() === current) {
		            $(this).addClass("my-btn-active");
		        }
		    }); 
		    
		    // Process other
		    if (documentLoad){
			    if (this.id == 'vbook-bookshelf' || this.id == 'vbook-personal' || this.id == 'vbook-store'){
			    	if ($('#main-footer').length > 0){
			    		$('#main-footer').toolbar().toolbar('show');
			    	}
			    }else if (this.id == 'book-reader'){
			    	if (bookReload == true){
				    	bookReload = false;
				    	vbookLoadBook();
				    }else{
				    	vbookShowBook();
				    }
			    }else if(this.id == 'book-reader-toc'){
			    	VBOOK.loadBookTocData('tocListView', 'book-reader-toc', 'book-reader');
			    }else if(this.id == 'book-reader-bookmark'){
			    	VBOOK.loadBookBookmarkData('bookmarkListView', 'book-reader-bookmark', 'book-reader');
			    }
		    }
		});
		
		function hideGlobalNavBar(){
			$('#main-footer').toolbar('hide');
		}
		
		function optimizeSpeed() {
			var hoverDelay = $.mobile.buttonMarkup.hoverDelay = 0;

			$.mobile.defaultPageTransition = 'none';
			$.mobile.defaultDialogTransition = 'none';
		}
		
		function gotoUserProfilePage(){
			$('#main-footer').toolbar('hide');
			$(':mobile-pagecontainer').pagecontainer("change", "userprofile.html", {transition:"slidefade"});
		}
		
		function gotoBookReaderPage(bookname){
			if (bookname != window.localStorage.getItem("vbook-book")){
				bookReload = true;
				window.localStorage.setItem("vbook-book", bookname);
			}
			$('#main-footer').toolbar('hide');
			//$("#main-footer").toolbar({ updatePagePadding: false,fullscreen:true });
			$(':mobile-pagecontainer').pagecontainer("change", "reader.html", {transition:"slidefade"});
		}
		
		function backBookReaderPage(){
			$(':mobile-pagecontainer').pagecontainer("change", "reader.html", {transition:"slidefade"});
		}
		
		function gotoBookReaderTocPage(){
			$(':mobile-pagecontainer').pagecontainer("change", "readertoc.html", {transition:"slidefade"});
		}
		
		function gotoBookReaderPageChapter(chapurl){
			backBookReaderPage();
			VBOOK.locateBookUrl(chapurl);
		}
		
		function gotoBookReaderPageCfi(cfi){
			backBookReaderPage();
			VBOOK.Book.gotoCfi(cfi);
		}
		
		function showGlobalNavBar(){
			if (isApp){
				StatusBar.show();
				screen.lockOrientation('portrait');
			}
			$('#main-footer').toolbar('show');
			//$("#main-footer").toolbar({ updatePagePadding: true,fullscreen:false });
		}
		
		window.addEventListener("orientationchange", function(){
		    console.log('Orientation changed to ' + screen.orientation);
		});
		
		//添加回退按钮事件
		document.addEventListener("backbutton",onBackKeyDown,false);  
		//BackButton按钮
		function onBackKeyDown(){ 
			if($.mobile.activePage.is('#vbook-bookshelf')){
				$('#main-footer').toolbar('show');
				navigator.app.exitApp(); 
			}else if($.mobile.activePage.is('#book-reader')){
				$(':mobile-pagecontainer').pagecontainer("change", $("#vbook-bookshelf"), {transition:"slidefade"});
				showGlobalNavBar();
			}else{
				navigator.app.backHistory(); 
			}
		}
		
		optimizeSpeed();
	</script>
	
</head>
<body>
	<div data-role="page" id="vbook-bookshelf" data-title="我的图书" data-quicklinks="true" data-theme="d">
		<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="d" role="banner" 
			class="ui-header ui-bar-a ui-header-fixed slidedown">
			<p>微训</p>
		</div><!-- /header -->
		<div class="vbook-books-toolbar">
			<div class="ui-filterable vbook-search-bar">
				<input id="vbook-books-search" data-type="search" placeholder="搜索">
			</div>
			<div id="vbook-books-menu" class="vbook-menu-right">
				<a href="#" onclick="openGroupMenu();" data-rel="popup" data-transition="pop">
				<!-- <img src="./images/ico-group-menu.png"/> -->
				<img src="./images/icon-carat-down.png"/>
				</a>
			</div>
		</div>
		<div data-role="popup" id="vbook-menu-group"
			class="vbook-menu-popup ui-popup-container ui-popup-active ui-popup ui-corner-all">
			<ul data-role="listview" data-inset="true">
				<li><a href="#" onclick="vbook_shelf_switch_cover_mode();">
					<img src="./images/vbook-menu-check.png" id="vbook-menu-item-cover-mode"
						class="ui-li-icon ui-corner-none vbook-show"/>封面模式
				</a></li>
				<li><a href="#" onclick="vbook_shelf_switch_list_mode();">
				<img src="./images/vbook-menu-check.png" id="vbook-menu-item-list-mode"
					class="ui-li-icon ui-corner-none vbook-hide"/>列表模式</a></li>
			</ul>
			<div  class="ui-popup-arrow-container ui-popup-arrow-t">
			<div id="vbook-menu-group-arrow" class="ui-popup-arrow ui-body-inherit"></div>
			</div>
		</div>
		<div role="main" id="vbook-shelf-main" class="ui-content vbook-shelf">
    		<ul data-role="listview" data-inset="true" data-filter="true" data-input="#vbook-books-search">
            	<li><div>
            		<a href="#" onclick="gotoBookReaderPage('books/progit/');">
	            	<div><img src="./books/progit.png" alt="ProGit" class="ui-li-thumb"></div>
	            	<p class="booktitle">ProGit</p>
	            	<p class="bookauthor">Scott Chacon and Ben Straub</p>
	            	<p class="bookbrief">Pro Git second edition, an open source book on Git.</p>
	            	<p class="vbook-new">新书首发</p>
            		</a>
            	</div></li> 
            	<!-- 
				<li><div><a href="bookread.html?book=books/jsty.epub">
				<div><img src="./books/jsty.png" alt="警世通言" class="ui-li-thumb"/></div>
				<p class="booktitle">警世通言</p>
				<p class="bookauthor">冯梦龙</p>
            	<p class="bookbrief">《警世通言》，白话短篇小说集。明末冯梦龙纂辑。完成于1624年（明天启四年）。其题材或来自民间传说，或来自史传和小说。故事描述的时代包括宋、元、明三代。</p>
				</a></div></li> 
				<li><div><a href="bookread.html?book=books/mcnxse.epub">
				<div><img src="./books/mcnxse.png" alt="明朝那些事儿" class="ui-li-thumb"/></div>
				<p class="booktitle">明朝那些事儿</p>
				<p class="bookauthor">当年明月</p>
            	<p class="bookbrief">《明朝那些事儿》[1]  ，网络连载历史小说，作者是当年明月，本名石悦，广东顺德海关公务员。2006年3月在天涯社区首次发表，2009年3月21日连载完毕，边写作边集结成书出版发行，一共7本 。</p>
				</a></div></li> 
				<li><div><a href="bookread.html?book=books/ydys.epub">
				<div><img src="./books/ydys.png" alt="元代野史" class="ui-li-thumb"/></div>
				<p class="booktitle">元代野史</p>
				<p class="bookauthor">田腾蛟</p>
            	<p class="bookbrief">元之先世，本号蒙古，其国在女真之北，以奇渥温三字为姓。有始祖母曰阿兰氏，寡居在极北沙漠。屡有光明耀腹，后一侞而生三子。季子曰孛端义儿，魁梧奇伟，沉毅寡言。其后子孙蕃盛，不相统属。......</p>
				</a></div></li> 
				<li><div><a href="bookread.html?book=books/ysmy.epub">
				<div><img src="./books/ysmy.png" alt="喻世明言" class="ui-li-thumb"/></div>
				<p class="booktitle">喻世明言</p>
            	<p class="bookauthor">冯梦龙</p>
            	<p class="bookbrief">《喻世明言》，白话短篇小说集，初刻用名《古今小说》，又称《全像古今小说》。明末冯梦龙纂辑。部分为宋元话本旧作，也有明人拟作。文字可能经过纂修者的加工。题材多来自民间，也有根据历史小说和前人小说改编改写的。</p>
				</a></div></li> 
				<li><div><a href="bookread.html?book=books/mobydick.epub">
				<div><img src="./books/mobydick.png" alt="Moby Dick" class="ui-li-thumb"/></div>
				<p class="booktitle">Moby Dick</p>
				<p class="bookauthor">Herman Melville</p>
            	<p class="bookbrief">A century and a half after its publication, "Moby-Dick" still stands as a literary classic. A novel of adventure the story of a madman pursuing an unholy war against a creature as vast and dangerous as the sea, it is also an important social commentary populated with several of the most unforgettable characters in literature. This edition features French flaps and deluxe packag...</p>
				</a></div></li> 
				<li><div><a href="#" onclick="gotoBookReaderPage('books/zyx/');">
				<div><img src="./books/cyjcsyx.png" alt="柴油机的测试及运行管理" class="ui-li-thumb"/></div>
				<p class="booktitle">柴油机的测试及运行管理</p>
				</a></div></li>  -->
				<li><div><a href="#" onclick="gotoBookReaderPage('books/testbook/');">
				<div><img src="./books/testbook-corver.png" alt="贷款实地调查" class="ui-li-thumb"/></div>
				<p class="booktitle">贷款实地调查</p>
				<p class="vbook-new">新书首发</p>
				</a></div></li> 
              </ul>
		</div><!-- /content -->
		<div data-role="popup" id="exitAppPopup">
		<p>再按一次推出程序</p>
		</div>
	</div><!-- /page -->

	<div data-role="page" id="vbook-personal" data-title="个人">
		<div class="perinfo">
			<div class="userpic"><a href="#"  onclick="gotoUserProfilePage();"><img src="images/user.png"></a></div>
			<div class="usernametxt">岁月如歌</div>
			<div class="usernameinfo">书币 0 &nbsp;&nbsp;&nbsp;等级：LV0</div>
		</div>
		<div data-role="none" class="read-profile" id="tab-news">	
	        <ul class="fix">
	            <li ><div class=pernavinfo><span class="pernavtxt">90</span><br>阅历</div></li>
	            <li><div class=pernavinfo><span class="pernavtxt">115</span><br>笔记</div></li>
	            <li><div class=pernavinfo style="border:0px;"><span class="pernavtxt">6</span><br>收藏</div></li>
	        </ul>
		</div>
		<div class="profile-toolbar" id="profile-toolbar">
	   		<ul>
	           	<li><a href=""><img src="images/cz.png" alt=""><br>充值</a></li> 
	               <li><a href=""><img src="images/qd.png" alt=""><br>签到</a></li>
	           	<li><a href=""><img src="images/set.png" alt=""><br>设置</a></li>
	           </ul>
		</div>
		<div class="profile-ads" id="profile-ads" >
			<ul >
				<li class="ads-grift"><div class="profile-ads-title-hot"><a href="">礼品中心</a><img src="images/ico-hot-rect.png"/><span class="hot-new">新</span></div>
				<div class="profile-ads-more"><a><img src="images/ico-btn-more.png" class="profile-ads-more-ico"/><span class="hot-msg">全民阅读，百万豪礼等你来拿！</span></a></div></li>
				<li class="ads-actives"><div class="profile-ads-title-hot"><a href="">活动中心</a><img src="images/ico-hot-rect.png"/><span class="hot-new">新</span></div>
				<div class="profile-ads-more"><a><img src="images/ico-btn-more.png" class="profile-ads-more-ico"><span class="hot-msg">限时免费，猛戳即可得到！</span></a></div></li>
				<li class="ads-tasks"><div class="profile-ads-title-hot"><a href="">任务中心</a><img src="images/ico-hot-rect.png"/><span class="hot-new">新</span></div>
				<div class="profile-ads-more"><a><img src="images/ico-btn-more.png" class="profile-ads-more-ico"><span class="hot-msg">24小时，根本停不下来!</span></a></div></li>
			</ul>
		</div>
	</div>
	<div data-role="page" id="vbook-store" data-title="书库">
	</div>
	
	<div data-role="page" id="vbook-userinfo" data-title="用户信息">
	</div>
	
	<div data-role="footer" id="main-footer" data-tap-toggle="false" data-theme="d" data-position="fixed" data-fullscreen="true">
		<div data-role="navbar" data-theme="d">
			<ul>
			<li id="library"><a href="#vbook-store" data-theme="d">书库</a></li>
			<li id="bookshelf"><a href="#vbook-bookshelf"  data-theme="d">我的图书</a></li>
			<li id="personal"><a href="#vbook-personal" data-theme="d">个人</a></li>
		</ul>
		</div>
	</div><!-- /footer -->

</body>
</html>

